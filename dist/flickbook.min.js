/*! Flickbook - v0.2.0 - 2013-01-24
* Copyright (c) 2013 Rhys Evans; Licensed MIT */
(function(e,t,n,r){function o(t,n){this.el=t,this.$el=e(t),this.opts=n,this._name=i,this.init()}function u(e){var t=e.startEvent.split(" ").sort(),n=e.stopEvent.split(" ").sort(),r=[],i=[],s=[];e:for(var o=0,u=t.length;o<u;o++){for(var a=0,f=n.length;a<f;a++)if(t[o]===n[a]){s.push(t[o]),n.splice(a,1);continue e}i.push(t[o])}e.startEvent=i.join(" "),e.stopEvent=n.join(" "),e.stopStartEvent=s.join(" ")}var i="flickbook",s=e.fn.on?"on":"bind";o.prototype.playing=!1,o.prototype.index=-1,o.prototype.init=function(){var t=this,n=this.$el.data(i+"-images");this.imageSrcs=n?n:e.isArray(this.opts.images)?this.opts.images.slice():this.opts.images,typeof this.imageSrcs=="string"?this.imageSrcs=this.imageSrcs.split(","):this.imageSrcs&&!e.isArray(this.imageSrcs)&&typeof this.imageSrcs=="object"&&this.imageSrcs.start&&this.imageSrcs.end&&this._getImageIndexesFromRange();if(!e.isArray(this.imageSrcs)||!this.imageSrcs.length){this.aborted=!0;return}this.imageCount=this.imageSrcs.length,this.fetchImages(),this.$el.data(i+"-images",this.images),this.$el[s]("start."+i,e.proxy(this,"start"))[s]("stop."+i,e.proxy(this,"stop"))[s](this.opts.stopEvent,function(){t.$el.trigger("stop."+i)})[s](this.opts.startEvent,function(){t.$el.trigger("start."+i)})[s](this.opts.stopStartEvent,function(){t.playing?t.$el.trigger("stop."+i):t.$el.trigger("start."+i)}),this.opts.autoStart&&this.start()},o.prototype._getImageIndexesFromRange=function(){var e=this,t=function(){var t=e.imageSrcs.padTo;return t?function(e){var n=e+"",r=n.length,i=t-r;if(i)while(i--)n="0"+n;return n}:function(e){return e+""}}(),n=this.imageSrcs.start,r=this.imageSrcs.end,i=[];for(var s=n;s<=r;s++)i.push(t(s));this.imageSrcs=i},o.prototype.start=function(){var e=this,t;this.playing||(this.to=setInterval(function(){if(e.opts.random){t=e.index;while(t===e.index)e.index=Math.floor(Math.random()*e.imageCount)}else e.index=(e.index+1)%e.imageCount;e.showImage()},this.opts.speed),this.playing=!0)},o.prototype.stop=function(){this.playing&&(clearInterval(this.to),this.opts.onStop==="reset"&&(this.index=0),this.showImage(),this.playing=!1)},o.prototype.showImage=function(){var e=0;while(!this.images[this.index]&&e<this.imageCount)this.index=(this.index+1)%this.imageCount,e++;this.$el.attr("src",this.images[this.index])},o.prototype.loadImage=function(t,n){var r=this;e('<img src="'+r.imageSrcs[t]+'">').load(function(){r.images[t+n]=r.imageSrcs[t],e.fn.flickbook.fetchedImages[r.imageSrcs[t]]=!0})},o.prototype.processImageSrcs=function(){var e=this,t=function(){return e.opts.imageTemplate.match("{{}}")?function(t){return e.opts.imageTemplate.replace("{{}}",t)}:function(t){return e.opts.imageTemplate+t}}();for(var n=0,r=this.imageCount;n<r;n++)this.imageSrcs[n]=t(this.imageSrcs[n])},o.prototype.fetchImages=function(){var t=0,n=this.$el.attr("src");this.images=[],this.opts.imageTemplate&&this.processImageSrcs(),this.opts.keepOriginalImage&&n!==this.imageSrcs[0]&&(this.images[0]=n,e.fn.flickbook.fetchedImages[n]=!0,t=1);for(var r=0,i=this.imageSrcs.length;r<i;r++)e.fn.flickbook.fetchedImages[this.imageSrcs[r]]?this.images[r+t]=this.imageSrcs[r]:this.loadImage(r,t)},e.fn[i]=function(t){return t=e.extend({},e.fn[i].defaults,t),u(t),this.each(function(){var n;e.data(this,"plugin_"+i)||(n=new o(this,t),n.aborted||e.data(this,"plugin_"+i,n))})},e.fn[i].fetchedImages={},e.fn[i].defaults={images:null,speed:100,imageTemplate:"",startEvent:"mouseover",stopEvent:"mouseout",autoStart:!1,onStop:"reset",keepOriginalImage:!0,random:!1}})(jQuery,window,document);