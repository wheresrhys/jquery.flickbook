(function(c){function d(a,e){this.el=a;this.$el=c(a);this.opts=e;this._name=b;this.init()}function h(a){var e=a.startEvent.split(" ").sort(),c=a.stopEvent.split(" ").sort(),b=[],d=[],f=0,h=e.length;a:for(;f<h;f++){for(var g=0,i=c.length;g<i;g++)if(e[f]===c[g]){d.push(e[f]);c.splice(g,1);continue a}b.push(e[f])}a.startEvent=b.join(" ");a.stopEvent=c.join(" ");a.stopStartEvent=d.join(" ")}var b="flickbook",f=c.fn.on?"on":"bind";d.prototype.playing=!1;d.prototype.index=-1;d.prototype.init=function(){var a=
this;this.imageSrcs=this.$el.data(b+"-images")||this.opts.images.slice();if(!c.isArray(this.imageSrcs))this.imageSrcs=this.imageSrcs.split(",");this.imageCount=this.imageSrcs.length;this.fetchImages();this.$el.data(b+"-images",this.images);this.$el[f]("start."+b,c.proxy(this,"start"))[f]("stop."+b,c.proxy(this,"stop"))[f](this.opts.stopEvent,function(){a.$el.trigger("stop."+b)})[f](this.opts.startEvent,function(){a.$el.trigger("start."+b)})[f](this.opts.stopStartEvent,function(){a.playing?a.$el.trigger("stop."+
b):a.$el.trigger("start."+b)});this.opts.autoStart&&this.start()};d.prototype.start=function(){var a=this,e;if(!this.playing)this.to=setInterval(function(){if(a.opts.random)for(e=a.index;e===a.index;)a.index=Math.floor(Math.random()*a.imageCount);else a.index=(a.index+1)%a.imageCount;a.showImage()},this.opts.speed),this.playing=!0};d.prototype.stop=function(){if(this.playing){clearInterval(this.to);if("reset"===this.opts.onStop)this.index=0;this.showImage();this.playing=!1}};d.prototype.showImage=
function(){for(var a=0;!this.images[this.index]&&a<this.imageCount;)this.index=(this.index+1)%this.imageCount,a++;this.$el.attr("src",this.images[this.index])};d.prototype.loadImage=function(a,e){var b=this;c('<img src="'+b.imageSrcs[a]+'">').load(function(){b.images[a+e]=b.imageSrcs[a];c.fn.flickbook.fetchedImages[b.imageSrcs[a]]=!0})};d.prototype.processImageSrcs=function(){for(var a=this,e=function(){return a.opts.imageTemplate.match("{{}}")?function(b){return a.opts.imageTemplate.replace("{{}}",
b)}:function(b){return a.opts.imageTemplate+b}}(),b=0,c=this.imageCount;b<c;b++)this.imageSrcs[b]=e(this.imageSrcs[b])};d.prototype.fetchImages=function(){var a=0,b=this.$el.attr("src");this.images=[];this.opts.imageTemplate&&this.processImageSrcs();this.opts.keepOriginalImage&&b!=this.imageSrcs[0]&&(this.images[0]=b,c.fn.flickbook.fetchedImages[b]=!0,a=1);for(var b=0,d=this.imageSrcs.length;b<d;b++)c.fn.flickbook.fetchedImages[this.imageSrcs[b]]?this.images[b+a]=this.imageSrcs[b]:this.loadImage(b,
a)};c.fn[b]=function(a){a=c.extend({},c.fn[b].defaults,a);if("string"===typeof a.images)a.images=a.images.split(",");else if(!c.isArray(a.images))return;h(a);return this.each(function(){c.data(this,"plugin_"+b)||c.data(this,"plugin_"+b,new d(this,a))})};c.fn[b].fetchedImages={};c.fn[b].defaults={images:null,speed:100,imageTemplate:"",startEvent:"mouseover",stopEvent:"mouseout",autoStart:!1,onStop:"reset",keepOriginalImage:!0,random:!1}})(jQuery,window,document);